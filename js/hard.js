const dictionary = [
  'abroad',
  'accept',
  'access',
  'across',
  'acting',
  'action',
  'active',
  'actual',
  'advice',
  'advise',
  'affect',
  'afford',
  'afraid',
  'agency',
  'agenda',
  'almost',
  'always',
  'amount',
  'animal',
  'annual',
  'answer',
  'anyone',
  'anyway',
  'appeal',
  'appear',
  'around',
  'arrive',
  'artist',
  'aspect',
  'assess',
  'assist',
  'assume',
  'attack',
  'attend',
  'august',
  'author',
  'avenue',
  'backed',
  'barely',
  'battle',
  'beauty',
  'became',
  'become',
  'before',
  'behalf',
  'behind',
  'belief',
  'belong',
  'better',
  'beyond',
  'bishop',
  'border',
  'bottle',
  'bottom',
  'bought',
  'branch',
  'breath',
  'bridge',
  'bright',
  'broken',
  'budget',
  'burden',
  'bureau',
  'button',
  'camera',
  'cancer',
  'cannot',
  'carbon',
  'career',
  'castle',
  'casual',
  'caught',
  'center',
  'centre',
  'chance',
  'change',
  'charge',
  'choice',
  'choose',
  'chosen',
  'church',
  'circle',
  'client',
  'closed',
  'closer',
  'coffee',
  'column',
  'combat',
  'coming',
  'common',
  'comply',
  'copper',
  'corner',
  'costly',
  'county',
  'couple',
  'course',
  'covers',
  'create',
  'credit',
  'crisis',
  'custom',
  'damage',
  'danger',
  'dealer',
  'debate',
  'decade',
  'decide',
  'defeat',
  'defend',
  'define',
  'degree',
  'demand',
  'depend',
  'deputy',
  'desert',
  'design',
  'desire',
  'detail',
  'detect',
  'device',
  'differ',
  'dinner',
  'direct',
  'doctor',
  'dollar',
  'domain',
  'double',
  'driven',
  'driver',
  'during',
  'easily',
  'eating',
  'editor',
  'effect',
  'effort',
  'eighth',
  'either',
  'eleven',
  'emerge',
  'empire',
  'employ',
  'enable',
  'ending',
  'energy',
  'engage',
  'engine',
  'enough',
  'ensure',
  'entire',
  'entity',
  'equity',
  'escape',
  'estate',
  'ethnic',
  'exceed',
  'except',
  'excess',
  'expand',
  'expect',
  'expert',
  'export',
  'extend',
  'extent',
  'fabric',
  'facing',
  'factor',
  'failed',
  'fairly',
  'fallen',
  'family',
  'famous',
  'father',
  'fellow',
  'female',
  'figure',
  'filing',
  'finger',
  'finish',
  'fiscal',
  'flight',
  'flying',
  'follow',
  'forced',
  'forest',
  'forget',
  'formal',
  'format',
  'former',
  'foster',
  'fought',
  'fourth',
  'friend',
  'future',
  'garden',
  'gather',
  'gender',
  'german',
  'global',
  'golden',
  'ground',
  'growth',
  'guilty',
  'handed',
  'handle',
  'happen',
  'hardly',
  'headed',
  'health',
  'height',
  'hidden',
  'holder',
  'honest',
  'impact',
  'import',
  'income',
  'indeed',
  'injury',
  'inside',
  'intend',
  'intent',
  'invest',
  'island',
  'itself',
  'jersey',
  'junior',
  'killed',
  'labour',
  'latest',
  'latter',
  'launch',
  'lawyer',
  'leader',
  'league',
  'leaves',
  'legacy',
  'length',
  'lesson',
  'letter',
  'lights',
  'likely',
  'linked',
  'liquid',
  'listen',
  'little',
  'living',
  'losing',
  'lucent',
  'luxury',
  'mainly',
  'making',
  'manage',
  'manner',
  'manual',
  'margin',
  'marine',
  'marked',
  'market',
  'martin',
  'master',
  'matter',
  'mature',
  'medium',
  'member',
  'memory',
  'mental',
  'merely',
  'merger',
  'method',
  'middle',
  'miller',
  'mining',
  'minute',
  'mirror',
  'mobile',
  'modern',
  'modest',
  'module',
  'moment',
  'morris',
  'mostly',
  'mother',
  'motion',
  'moving',
  'murder',
  'museum',
  'mutual',
  'myself',
  'narrow',
  'nation',
  'native',
  'nature',
  'nearby',
  'nearly',
  'nights',
  'nobody',
  'normal',
  'notice',
  'notion',
  'number',
  'object',
  'obtain',
  'office',
  'offset',
  'online',
  'option',
  'orange',
  'origin',
  'output',
  'oxford',
  'packed',
  'palace',
  'parent',
  'partly',
  'patent',
  'patrol',
  'people',
  'period',
  'permit',
  'person',
  'phrase',
  'picked',
  'pistol',
  'planet',
  'player',
  'please',
  'plenty',
  'pocket',
  'police',
  'policy',
  'prefer',
  'pretty',
  'prince',
  'prison',
  'profit',
  'proper',
  'proven',
  'public',
  'pursue',
  'raised',
  'random',
  'rarely',
  'rather',
  'rating',
  'reader',
  'really',
  'reason',
  'recall',
  'recent',
  'record',
  'reduce',
  'reform',
  'regard',
  'regime',
  'region',
  'relate',
  'relief',
  'remain',
  'remote',
  'remove',
  'repair',
  'repeat',
  'replay',
  'report',
  'rescue',
  'resort',
  'result',
  'retail',
  'retain',
  'return',
  'reveal',
  'review',
  'reward',
  'riding',
  'rising',
  'robust',
  'ruling',
  'safety',
  'salary',
  'sample',
  'saving',
  'saying',
  'scheme',
  'school',
  'screen',
  'search',
  'season',
  'second',
  'secret',
  'sector',
  'secure',
  'seeing',
  'select',
  'seller',
  'senior',
  'series',
  'server',
  'settle',
  'severe',
  'sexual',
  'should',
  'signal',
  'signed',
  'silent',
  'silver',
  'simple',
  'simply',
  'single',
  'sister',
  'slight',
  'smooth',
  'social',
  'solely',
  'sought',
  'source',
  'soviet',
  'speech',
  'spirit',
  'spoken',
  'spread',
  'spring',
  'square',
  'stable',
  'status',
  'steady',
  'stolen',
  'strain',
  'stream',
  'street',
  'stress',
  'strict',
  'strike',
  'string',
  'strong',
  'struck',
  'studio',
  'submit',
  'sudden',
  'suffer',
  'summer',
  'summit',
  'supply',
  'surely',
  'survey',
  'switch',
  'symbol',
  'system',
  'taking',
  'talent',
  'target',
  'taught',
  'tenant',
  'tender',
  'tennis',
  'thanks',
  'theory',
  'thirty',
  'though',
  'threat',
  'thrown',
  'ticket',
  'timely',
  'timing',
  'tissue',
  'toward',
  'travel',
  'treaty',
  'trying',
  'twelve',
  'twenty',
  'unable',
  'unique',
  'united',
  'unless',
  'unlike',
  'update',
  'useful',
  'valley',
  'varied',
  'vendor',
  'versus',
  'victim',
  'vision',
  'visual',
  'volume',
  'walker',
  'wealth',
  'weekly',
  'weight',
  'wholly',
  'window',
  'winner',
  'winter',
  'within',
  'wonder',
  'worker',
  'wright',
  'writer',
  'yellow',
];
const state = {
  secret: dictionary[Math.floor(Math.random() * dictionary.length)],
  grid: Array(5)
    .fill()
    .map(() => Array(6).fill('')),
  currentRow: 0,
  currentCol: 0,
};

function drawGrid(container) {
  const grid = document.createElement('div');
  grid.className = 'grid';

  for (let i = 0; i < 5; i++) {
    for (let j = 0; j < 6; j++) {
      drawBox(grid, i, j);
    }
  }

  container.appendChild(grid);
}

function updateGrid() {
  for (let i = 0; i < state.grid.length; i++) {
    for (let j = 0; j < state.grid[i].length; j++) {
      const box = document.getElementById(`box${i}${j}`);
      box.textContent = state.grid[i][j];
    }
  }
}

function drawBox(container, row, col, letter = '') {
  const box = document.createElement('div');
  box.className = 'box';
  box.textContent = letter;
  box.id = `box${row}${col}`;

  container.appendChild(box);
  return box;
}

function registerKeyboardEvents() {
  document.body.onkeydown = (e) => {
    const key = e.key;
    if (key === 'Enter') {
      if (state.currentCol === 6) {
        const word = getCurrentWord();
        if (isWordValid(word)) {
          revealWord(word);
          state.currentRow++;
          state.currentCol = 0;
        } else {
          alert('Invalid word.');
        }
      }
    }
    if (key === 'Backspace') {
      removeLetter();
    }
    if (isLetter(key)) {
      addLetter(key);
    }

    updateGrid();
  };
}

function getCurrentWord() {
  return state.grid[state.currentRow].reduce((prev, curr) => prev + curr);
}

function isWordValid(word) {
  return dictionary.includes(word);
}

function getNumOfOccurrencesInWord(word, letter) {
  let result = 0;
  for (let i = 0; i < word.length; i++) {
    if (word[i] === letter) {
      result++;
    }
  }
  return result;
}

function getPositionOfOccurrence(word, letter, position) {
  let result = 0;
  for (let i = 0; i <= position; i++) {
    if (word[i] === letter) {
      result++;
    }
  }
  return result;
}

function revealWord(guess) {
  const row = state.currentRow;
  const animation_duration = 500; // ms

  for (let i = 0; i < 6; i++) {
    const box = document.getElementById(`box${row}${i}`);
    const letter = box.textContent;
    const numOfOccurrencesSecret = getNumOfOccurrencesInWord(
      state.secret,
      letter
    );
    const numOfOccurrencesGuess = getNumOfOccurrencesInWord(guess, letter);
    const letterPosition = getPositionOfOccurrence(guess, letter, i);

    setTimeout(() => {
      if (
        numOfOccurrencesGuess > numOfOccurrencesSecret &&
        letterPosition > numOfOccurrencesSecret
      ) {
        box.classList.add('empty');
      } else {
        if (letter === state.secret[i]) {
          box.classList.add('correct');
        } else if (state.secret.includes(letter)) {
          box.classList.add('close');
        } else {
          box.classList.add('empty');
        }
      }
    }, ((i + 1) * animation_duration) / 3);

    box.classList.add('animated');
    box.style.animationDelay = `${(i * animation_duration) / 3}ms`;
  }

  const isWinner = state.secret === guess;
  const isGameOver = state.currentRow === 4;

  setTimeout(() => {
    if (isWinner) {
      alert('Congratulations!');
    } else if (isGameOver) {
      alert(`Good try! The word was ${state.secret}.`);
    }
  }, 3 * animation_duration);
}

function isLetter(key) {
  return key.length === 1 && key.match(/[a-z]/i);
}

function addLetter(letter) {
  if (state.currentCol === 6) return;
  state.grid[state.currentRow][state.currentCol] = letter;
  state.currentCol++;
}

function removeLetter() {
  if (state.currentCol === 0) return;
  state.grid[state.currentRow][state.currentCol - 1] = '';
  state.currentCol--;
}

function startup() {
  const game = document.getElementById('game');
  drawGrid(game);

  registerKeyboardEvents();

  console.log(state.secret);
}

startup();
